# Telegram Message Processing Bot

Проект LangGraph для автоматической обработки сообщений из Telegram каналов с AI-анализом и пересылкой результатов.

## Возможности

- **Получение сообщений** из указанных Telegram каналов за заданный период времени
- **AI-анализ каждого сообщения** с действиями:
  - Перефразирование на правильном русском языке
  - Фильтрация ненужных сообщений (спам, флуд, короткие реплики)
- **Пересылка обработанных сообщений** в указанный Telegram канал
- Автоматический запуск каждые 5 минут
- Использование модели Qwen3-Coder-Plus для анализа
- Интеграция с telegram-mcp для доступа к сообщениям

## Архитектура

Проект использует LangGraph workflow с тремя основными узлами:

1. **fetch_messages_from_channels_node**: Получает сообщения из указанных каналов за заданный период
2. **analyze_messages_node**: Анализирует каждое сообщение через AI модель
3. **send_results_node**: Отправляет обработанные сообщения в целевой канал

## Установка

1. Установите зависимости с помощью uv:
```bash
uv sync
```

2. Убедитесь, что у вас есть:
   - Рабочие OAuth креденшиалы Qwen в `/home/vyt/.qwen/oauth_creds.json`
   - Настроенный telegram-mcp сервер в `/home/vyt/devel/telegram-mcp`

## Использование

### Запуск основного бота (каждые 5 минут):
```bash
uv run python -m src.main
```

### Тестирование (однократный запуск):
```bash
uv run python test_processing.py
```

### Параметры workflow:
```python
await run_processing_workflow(
    source_channels=["BitKogan / Development"],  # Список каналов для получения сообщений
    time_period_minutes=10,                     # Период в минутах для получения сообщений
    target_channel="infotest"                   # Канал для отправки результатов
)
```

## Компоненты

- `qwen_client.py`: Клиент для Qwen API с OAuth аутентификацией
- `qwen_langchain.py`: LangChain интеграция для Qwen
- `telegram_mcp_client.py`: Клиент для взаимодействия с telegram-mcp
- `workflow.py`: LangGraph workflow для обработки сообщений
- `main.py`: Основной скрипт с планировщиком

## AI-анализ сообщений

Каждое сообщение анализируется AI моделью с возможными действиями:

- **Перефразирование**: Исправление грамматических ошибок и улучшение формулировки
- **Фильтрация**: Удаление бесполезных сообщений (эмодзи, "ок", "+1", спам)

Результат анализа в JSON формате:
```json
{"action": "rephrase", "text": "исправленный текст"}
{"action": "filter", "reason": "причина фильтрации"}
```

## Текущее состояние

✅ **Работает:**
- Получение сообщений из Telegram каналов
- AI-анализ и обработка каждого сообщения
- Пересылка результатов в целевой канал
- Qwen API интеграция с OAuth токенами
- LangGraph workflow с тремя узлами

## Требования

- Python 3.11+
- Рабочие OAuth креденшиалы Qwen
- uv для управления зависимостями
- Доступ к telegram-mcp серверу
